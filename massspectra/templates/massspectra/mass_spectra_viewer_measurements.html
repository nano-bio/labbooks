{% load static %}

<div class="form-floating mb-1">
    <input type="text" class="form-control form-control-sm" id="inputSearchMeasurement" placeholder="Search...">
    <label for="inputSearchMeasurement">Search</label>
</div>
<div style="overflow-y: scroll; max-height: 800px" id="measurementsArea">
    <ul class="list-group" id="measurements"></ul>
</div>
<script src="{% static 'clusterize/clusterize.min.js' %}"></script>
<script>
  $.getJSON("{{ mass_spectra_measurements_url }}", function (data) {
    const rows = data

    function filterRows(rows) {
      let results = [];
      for (let i = 0, ii = rows.length; i < ii; i++) {
        if (rows[i].active) results.push(rows[i].markup)
      }
      return results;
    }

    /*
    * Init clusterize.js
    */
    const clusterize = new Clusterize({
      rows: filterRows(rows),
      scrollId: 'measurementsArea',
      contentId: 'measurements'
    });

    /*
    * Attach listener to search input tag and filter list on change
    */
    function onSearch() {
      for (let i = 0, ii = rows.length; i < ii; i++) {
        if (rows[i].markup.toString().toLowerCase().indexOf(search.value.toString().toLowerCase()) + 1)
          rows[i].active = true;
      }
      clusterize.update(filterRows(rows));
    }

    const search = document.getElementById('inputSearchMeasurement')
    search.oninput = onSearch;
  });
</script>
